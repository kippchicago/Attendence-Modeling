<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Fall 2012 MAP Results by Students with Target Setting and Comparative Distributions</title>

<base target="_blank"/>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
}

pre code {
   display: block; padding: 0.5em;
}

code.r {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>


<!-- MathJax scripts -->
<script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



</head>

<body>
<h1>Fall 2012 MAP Results by Students with Target Setting and Comparative Distributions</h1>

<p>This file is the literate programming source for a script that pulls our data from our Data Analysis <code>MySQL</code> database. I&#39;ll add references to how we get data into the database, as needed.  Nevertheless, this document focuses on the process of how we pull data from the DB and analyse it in <a href="www.r-project.org"><code>R</code></a></p>

<p>There are three aims of this document</p>

<ol>
<li>To show how I connect <code>R</code> to a <code>MySQL&#39; database and use a</code>SQL query to populate a dataframe with the data I want.</li>
<li>Provide some exmaples of data manipulation and building graphics leveraging <code>ggplot2</code>.</li>
<li>Emphasize how writing functions can save you so much time (both in producing analyses and in debugging code).</li>
<li>Encourage <a href="http://en.wikipedia.org/wiki/Literate_programming">literate probramming</a> practices (which are dead simple in <a href="http://www.rstudio.org">RStudio</a>).</li>
<li>Inspire the adoption of <code>R</code> throughout the KIPP Network. </li>
</ol>

<hr/>

<h2>Prelims</h2>

<p>I start by setting some global parameters for my R markdown file (i.e, this file), then updating the present working directory and loading the packaged used in the data analysis.</p>

<pre><code class="r">opts_chunk$set(tidy = TRUE, echo = TRUE, dpi = 150, fig.align = &quot;center&quot;, fig.height = 6.3125, 
    fig.width = 5, fig.path = &quot;./public_figures/&quot;, message = FALSE)
</code></pre>

<pre><code class="r">setwd(&quot;~/Dropbox/Consulting/KIPP Ascend/Data Analysis/MAP/Code/R&quot;)



library(RODBC)  #To get data form Data Analysis DB
library(plyr)  #To manipulate data
library(reshape)  #More data manipulation
library(ggplot2)  #Graphics of grammer graphing
library(grid)  #More Graphing
library(gridExtra)  #better than par(mfrow=c(r,c)) for arranging ggplot2 and lattice graphics
library(randomNames)  #to do as it says and generate random names by gender and ethnicity.  Awesome!
</code></pre>

<h3>Loading Data into MySQL Database</h3>

<p>We use two steps to get the data into the database:</p>

<ol>
<li><strong>Cleaning</strong>: re-factoring the CDF&#39;s separate csv files so they comport with <code>MySQL</code> conventions. This is done with a &ldquo;one touch&rdquo; shell script that uses <code>sed</code> and regular expressions to make all necessary character substations. Theone-touch script for cleaning the data can be found <a href="http://github.com/chrishaid/Data_Analysis/blob/master/MAP/Code/SQL/map_cdf_prep.sh">here</a>;<br/></li>
<li><strong>Loading</strong>:putting the separate CSV files as separate tables into the data analysis database.  Doing so ensures that we maintain the data in as similar manner as we receive it from NWEA. The <code>SQL</code> code for loading the data is <a href="github.com/chrishaid/Data_Analysis/blob/master/MAP/Code/SQL/Data_Loading_MAP.sql">here</a>.</li>
</ol>

<h3>Retrieving Data from MySQL Database</h3>

<p>Once the data loaded, we use the <code>RODBC</code> package in <code>R</code> to establish a connection to the database and run a SQL query to populate a dataframe (NB: <code>kippchidata2</code> is a DSN with appropriate key value pairs that allows an <code>ODBC</code> connection to be established with the MySQL&#39; server).  To protect the privacy of our students while simultaneously showing you all my work flow, I&#39;ve suppressed the evaluation of the following code.  That is, this next chunk of code is not run.</p>

<pre><code class="r">
# Create database connection.  

con&lt;-odbcConnect(&quot;kippchidata2&quot;)

#get MAP data with SQL statement
map.scores&lt;-sqlQuery(con, 
&quot;SELECT  t.StudentID AS ID,
        t.`StudentFirstName`,
        t.`StudentLastName`,
        t.`SchoolName`,
        t.`Grade`,  
        t.`ClassName`,
        t.MeasurementScale AS Subject,
        t.GrowthMeasureYN AS Fall12_GM,
        t.TestType AS  Fall12_TT, 
        t.TestRITScore AS Fall12_RIT,
        t.TestPercentile AS Fall12_Pctl,
        n.t42 as TypicalFallToSpringGrowth,
        n.r42 as ReportedFallToSpringGrowth,
        n.s42 as SDFallToSpringGrowth,
        CASE
            WHEN TestPercentile &gt;= 75 THEN 4
            WHEN TestPercentile &lt; 75 AND TestPercentile&gt;=50 THEN 3
            WHEN TestPercentile &lt; 50 AND TestPercentile&gt;=25 THEN 2
            ELSE 1
        END AS Quartile

FROM    (
        SELECT  a.*,
                c.ClassName
        FROM `tblClassAssignmentsFall12` as c
        JOIN (
            Select  r.*, 
                    s.DistrictName,
                    s.`StudentDateOfBirth`,
                    s.`StudentEthnicGroup`,
                    s.`StudentLastName`,
                    s.`StudentFirstName`,
                    s.`StudentMI`,
                    s.`Grade`
            FROM    tblAssessmentResultsFall12 as r
            JOIN    tblStudentBySchoolFall12 as s
            ON      r.`StudentID`=s.StudentID
            ) as a
        ON a.StudentID=c.StudentID
        ) as t
LEFT OUTER JOIN `viewNorms2011_Growth_Kinder_0` as n
ON      t.`TestRITScore`=n.`StartRIT`
AND     t.`Grade`=n.`StartGrade2`
AND     t.`MeasurementScale`=n.`MeasurementScale`
WHERE   #GrowthMeasureYN=&#39;True&#39; AND
    (TestType=&#39;Survey with Goals&#39;
        OR 
        TestType=&#39;Survey&#39;
        )
;

&quot;)

#Check contents
head(map.scores)

#Reorder levels (since 13=Kinder, prior to Fall 2012, after that it is Kinder=0) and rename
map.scores$Grade &lt;- factor(map.scores$Grade, levels=c(&quot;0&quot;, &quot;1&quot;,&quot;2&quot;, &quot;5&quot;, &quot;6&quot;,&quot;7&quot;,&quot;8&quot;))
levels(map.scores$Grade) &lt;- c(&quot;K&quot;, &quot;1&quot;, &quot;2&quot;, &quot;5&quot;, &quot;6&quot;,&quot;7&quot;,&quot;8&quot;)
</code></pre>

<h3>Masked Data!!!</h3>

<p>Since I didn&#39;t run the data loading code that I do run for KIPP Chicago&#39;s own reporting, I need to generate some face data, which is pretty straightforward.  Mostly I need fake names to mask the identity of our students.  I&#39;ll pull actual test scores from the database so that we can use real targets and percentiles in the graphics to follow.</p>

<pre><code class="r">
# Create database connection.  
con&lt;-odbcConnect(&quot;kippchidata2&quot;)
</code></pre>

<pre><code>## Warning: [RODBC] ERROR: state HY000, code 2003, message [MySQL][ODBC 5.1
## Driver]Can&#39;t connect to MySQL server on &#39;54.245.118.235&#39; (60)
</code></pre>

<pre><code>## Warning: ODBC connection failed
</code></pre>

<pre><code class="r">
#Pull data from db with SQL query
map.scores&lt;-sqlQuery(con, 
&quot;SELECT  t.`SchoolName`,
    t.`Grade`,  
        t.`ClassName`,
        t.MeasurementScale AS Subject,
        t.GrowthMeasureYN AS Fall12_GM,
        t.TestType AS  Fall12_TT, 
        t.TestRITScore AS Fall12_RIT,
        t.TestPercentile AS Fall12_Pctl,
        n.t42 as TypicalFallToSpringGrowth,
        n.r42 as ReportedFallToSpringGrowth,
        n.s42 as SDFallToSpringGrowth,
        CASE
            WHEN TestPercentile &gt;= 75 THEN 4
            WHEN TestPercentile &lt; 75 AND TestPercentile&gt;=50 THEN 3
            WHEN TestPercentile &lt; 50 AND TestPercentile&gt;=25 THEN 2
            ELSE 1
        END AS Quartile

FROM    (
        SELECT  a.*,
                c.ClassName
        FROM `tblClassAssignmentsFall12` as c
        JOIN (
            Select  r.*, 
                    s.DistrictName,
                    s.`StudentDateOfBirth`,
                    s.`StudentEthnicGroup`,
                    s.`StudentLastName`,
                    s.`StudentFirstName`,
                    s.`StudentMI`,
                    s.`Grade`
            FROM    tblAssessmentResultsFall12 as r
            JOIN    tblStudentBySchoolFall12 as s
            ON      r.`StudentID`=s.StudentID
            ) as a
        ON a.StudentID=c.StudentID
        ) as t
LEFT OUTER JOIN `viewNorms2011_Growth_Kinder_0` as n
ON      t.`TestRITScore`=n.`StartRIT`
AND     t.`Grade`=n.`StartGrade2`
AND     t.`MeasurementScale`=n.`MeasurementScale`
WHERE GrowthMeasureYN=&#39;True&#39; 
      AND
      (TestType=&#39;Survey with Goals&#39;
          OR 
          TestType=&#39;Survey&#39;
          )
      AND t.MeasurementScale =&#39;Mathematics&#39;
      AND Grade=5
      AND SchoolName=&#39;KIPP Ascend Middle School&#39;                   
;

&quot;)
</code></pre>

<pre><code>## Error: first argument is not an open RODBC channel
</code></pre>

<pre><code class="r">
#need to add fake first and last names data using randomName package

#need set of ethnicities to draw form.  95% African American implies 19:1 odds.  Assume gender is 1:1.
ethnicities &lt;- c(rep(&quot;African American&quot;,19), &quot;Hispanic&quot;)
genders &lt;- c(&quot;Female&quot;, &quot;Male&quot;)

#now need to construct 2vectors (length = lenght(map.scores) drawn from the two sets above)

genderethnicity.df&lt;-data.frame(Gender=sample(genders, nrow(map.scores), replace=TRUE), 
                               Ethnicity=sample(ethnicities, nrow(map.scores), replace=TRUE))
</code></pre>

<pre><code>## Error: object &#39;map.scores&#39; not found
</code></pre>

<pre><code class="r">
names.df&lt;-data.frame(StudentLastName=randomNames(gender=genderethnicity.df$Gender,
                                                 ethnicity=genderethnicity.df$Ethnicity, which.names=&quot;last&quot;),
                     StudentFirstName=randomNames(gender=genderethnicity.df$Gender,
                                                  ethnicity=genderethnicity.df$Ethnicity, which.names=&quot;first&quot;
                                                  )
                     )
</code></pre>

<pre><code>## Error: object &#39;genderethnicity.df&#39; not found
</code></pre>

<pre><code class="r">
map.scores&lt;-cbind(names.df, map.scores)
</code></pre>

<pre><code>## Error: object &#39;names.df&#39; not found
</code></pre>

<pre><code class="r">
head(map.scores)
</code></pre>

<pre><code>## Error: object &#39;map.scores&#39; not found
</code></pre>

<hr/>

<h2>Data Manipulation</h2>

<h3>MAP Target Setting</h3>

<p>The term &ldquo;Growth Target&rdquo; is misnomer.  The &ldquo;growth target&rdquo; is simply a students expected (or average) growth conditional on their starting RIT score and current grade.  That is, the period 1 to period 2  &ldquo;growth target&rdquo; is the average difference in period 1 and period 2 scores for all students in a particular grade with same period 1 score.  For this reason I refer to the the NWEA supplied &ldquo;growth targets&rdquo; as <em>expected growth</em> (a statistically meaningful term) or <em>typical growth</em> (a substantively meaningful term). As Andrew Martin at Team schools, among others, has made clear, if our students merely hit their expected growth numbers every year through 11th grade they will on average not be &ldquo;Rutgers Ready&rdquo; (Team&#39;s clever alliteration).</p>

<p>Time requires that I eschew Andrew&#39;s quadratic-fit goal-setting that they employ in Newark. Instead, I use the data we have from the 2011 MAP Norms Table to provide our teachers and students targets that at the 75th percentile of growth (i.e., the mean plus .675 standard deviations) for each Grade-Subject-Fall RIT score triplet. </p>

<pre><code class="r"># get z score (i.e., number of standard deviations) that corresponds to
# 75th percentile
sigma &lt;- qnorm(0.75)
# add simga*SD to mean and round to integer
map.scores$GrowthPctl75th &lt;- round(map.scores$TypicalFallToSpringGrowth + sigma * 
    map.scores$SDFallToSpringGrowth, 0)
</code></pre>

<pre><code>## Error: object &#39;map.scores&#39; not found
</code></pre>

<pre><code class="r">
# calculate targets
map.scores$GrowthTargets &lt;- map.scores$Fall12_RIT + map.scores$GrowthPctl75th
</code></pre>

<pre><code>## Error: object &#39;map.scores&#39; not found
</code></pre>

<pre><code class="r">
# Combine Student First and Last Names into one field

map.scores$StudentLastFirstName &lt;- paste(map.scores$StudentLastName, map.scores$StudentFirstName, 
    sep = &quot;, &quot;)
</code></pre>

<pre><code>## Error: object &#39;map.scores&#39; not found
</code></pre>

<pre><code class="r">map.scores$StudentFirstLastName &lt;- paste(map.scores$StudentFirstName, map.scores$StudentLastName, 
    sep = &quot; &quot;)
</code></pre>

<pre><code>## Error: object &#39;map.scores&#39; not found
</code></pre>

<hr/>

<p>##Visualizations</p>

<h3>MAP Results by Students with Targets, or How is each student doing relative to every other student in her class?</h3>

<p>So now we move on to graphing, leaning heavily (completely?) on the <a href="http://www.http://ggplot2.org/">Hadley Wickham&#39;s <code>ggplot2</code></a> package.</p>

<p>In order to list students by order of test scores, I need a function to add a column that adds a counter after they are sorted on a given column&#39;s values.  Fortuitously, I&#39;ve written this function&mdash;along with a number of other helper functions for this analysis&mdash;in an <code>R</code> script called (perhaps obviously) <code>MAP_helper_functions.R</code>, which is located in this directory of the GIT repo.</p>

<pre><code class="r">source(&quot;MAP_helper_functions.R&quot;)
</code></pre>

<p>OK. Now to graphics.  Here I want to graph the fall score, the expected growth and the college ready 75th percentile growth.  Since we want graphs by grade we need to use <code>ddply</code> to run <code>fn_orderid</code> over each grade as well as each classroom for each subject:</p>

<pre><code class="r">map.scores.by.grade &lt;- ddply(map.scores, .(Subject, SchoolName, Grade), function(df) orderid(df, 
    df$Fall12_RIT))
</code></pre>

<pre><code>## Error: object &#39;map.scores&#39; not found
</code></pre>

<pre><code class="r">map.scores.by.class &lt;- ddply(map.scores, .(Subject, SchoolName, ClassName), 
    function(df) orderid(df, df$Fall12_RIT))
</code></pre>

<pre><code>## Error: object &#39;map.scores&#39; not found
</code></pre>

<pre><code class="r">
head(map.scores.by.grade)
</code></pre>

<pre><code>## Error: object &#39;map.scores.by.grade&#39; not found
</code></pre>

<pre><code class="r">head(map.scores.by.class)
</code></pre>

<pre><code>## Error: object &#39;map.scores.by.class&#39; not found
</code></pre>

<pre><code class="r">
#KIPP Foundation approved colors
kippcols&lt;-c(&quot;#E27425&quot;, &quot;#FEBC11&quot;, &quot;#255694&quot;, &quot;A7CFEE&quot;)

#Plot points for Fall RIT Score, Expected Growth, College Ready Growth, ordered by Fall RIT, Names on Y axis
pointsize&lt;-2
p &lt;- ggplot(map.scores.by.grade, aes(x=Fall12_RIT, 
                                     y=OrderID)) +
     geom_text(aes(x=Fall12_RIT-1, 
                  color=as.factor(Quartile), 
                  label=StudentFirstLastName), 
              size=2, 
              hjust=1) +
    geom_point(aes(color=as.factor(Quartile)), 
               size=pointsize) +
    geom_text(aes(x=Fall12_RIT+1,
                  color=as.factor(Quartile), 
                  label=Fall12_RIT), 
              size=2, 
              hjust=0) +
    geom_point(aes(x=Fall12_RIT + ReportedFallToSpringGrowth, 
                   y=OrderID), 
               color=&quot;#CFCCC1&quot;, 
               size=pointsize) +
    geom_text(aes(x=Fall12_RIT + ReportedFallToSpringGrowth+1, 
                  label=Fall12_RIT + ReportedFallToSpringGrowth), 
              color=&quot;#CFCCC1&quot;, 
              size=2, 
              hjust=0) +
    geom_point(aes(x=GrowthTargets, 
                   y=OrderID), 
               color=&quot;#FEBC11&quot;, 
               size=pointsize) + 
    geom_text(aes(x=GrowthTargets+1, 
                  label=GrowthTargets), 
              color=&quot;#FEBC11&quot;, 
              size=2, 
              hjust=0) +
    facet_grid(Quartile~., scale=&quot;free_y&quot;, space = &quot;free_y&quot;, as.table=FALSE) +
    scale_colour_discrete(kippcols) + 
    scale_y_continuous(&quot; &quot;, breaks=map.scores.by.grade$OrderID, expand=c(0,1)) + 
    theme(axis.text.y = element_text(size=3, hjust=1)) + 
    theme(legend.position = &quot;none&quot;) + 
    scale_x_continuous(&quot;RIT Score&quot;) + 
    expand_limits(x=145)+
    theme(panel.background = element_rect(fill = &quot;transparent&quot;,colour = NA), # or element_blank()
          plot.background = element_rect(fill = &quot;transparent&quot;,colour = NA),

          axis.text.x = element_text(size=15),
          axis.text.y = element_blank(), 
          axis.ticks=element_blank(),

          strip.text.x=element_text(size=15),
          strip.text.y=element_text(size=15,angle=0), 
          strip.background=element_rect(fill=&quot;#F4EFEB&quot;, colour=NA),

          plot.title=element_text(size=12)
        ) +
        ggtitle(&quot;2012 Fall 5th Grade Mathematics\nRIT Scores, 
                Expected Growth, and College Ready Growth\nby Quartile&quot;)  
</code></pre>

<pre><code>## Error: object &#39;map.scores.by.grade&#39; not found
</code></pre>

<pre><code class="r">

###Let&#39;s add some summary labels by quaritle to p

#First get the per panel data I want count by quartile, avg y-position (given by OrderID) by quartile,
#  avg RIT by quartile, and percent of quartile students to total studens.

qrtl.labels&lt;-get_group_stats(map.scores.by.grade, grp=&quot;Quartile&quot;)
</code></pre>

<pre><code>## Error: object &#39;map.scores.by.grade&#39; not found
</code></pre>

<pre><code class="r">
#add a column with the actual label text
qrtl.labels$CountLabel&lt;-paste(qrtl.labels$CountStudents,
                              &quot; students (&quot;,
                              round(qrtl.labels$PctofTotal*100),&quot;%)&quot;, 
                              sep=&quot;&quot;)
</code></pre>

<pre><code>## Error: object &#39;qrtl.labels&#39; not found
</code></pre>

<pre><code class="r">
qrtl.labels$AvgLabel&lt;-paste(&quot;Avg RIT = &quot;,round(qrtl.labels$AvgQrtlRIT))
</code></pre>

<pre><code>## Error: object &#39;qrtl.labels&#39; not found
</code></pre>

<pre><code class="r">
#eyeballed X position
qrtl.labels$xpos&lt;-rep(150,nrow(qrtl.labels))
</code></pre>

<pre><code>## Error: object &#39;qrtl.labels&#39; not found
</code></pre>

<pre><code class="r">
#now adding this info to the plot p
p &lt;- p + geom_text(data=qrtl.labels, 
                   aes(x=xpos, 
                       y=AvgCountID, 
                       color=factor(Quartile),
                       label=CountLabel),
                   vjust=0, 
                   size=3.25) +
    geom_text(data=qrtl.labels, 
              aes(x=xpos, 
                  y=AvgCountID, 
                  color=factor(Quartile),
                  label=AvgLabel),
              vjust=1.5, 
              size=3.25)
</code></pre>

<pre><code>## Error: object &#39;p&#39; not found
</code></pre>

<pre><code class="r">
p
</code></pre>

<pre><code>## Error: object &#39;p&#39; not found
</code></pre>

<pre><code class="r">
#Uncomment below to save pdf vector file of plot for other uses. 
ggsave(p,file=&quot;plot_Goal_by_grade_KAPS_1.pdf&quot;,height=10.5,width=8)
</code></pre>

<pre><code>## Error: object &#39;p&#39; not found
</code></pre>

<p>I liked plot so much that I&#39;ve written a function (<code>plot_MAP_Results_and_Goals</code>) so I can very quickly reproduce it for any grade and Class combination, which is sourced above in the <a href="https://github.com/chrishaid/Data_Analysis/blob/master/MAP/Code/R/MAP_helper_functions.R"><code>MAP_helper_function.R</code></a> script (\( \leftarrow \) that&#39;s a clickable link to the code).  Right now it is only useful if the dataframe has very specific column names.  However, it is a stake in the ground that for a later re-factoring towards a more general function.  That notwithstanding time pressure, here&#39;s the current function in actions (*<em>NB: This code isn&#39;t evaluated here; it is only an exmaple *</em>)</p>

<pre><code class="r">#Relevel subject factors 
map.scores.by.grade$Subject&lt;-factor(map.scores.by.grade$Subject, 
                                    levels=c(&quot;Mathematics&quot;, 
                                             &quot;Reading&quot;, 
                                             &quot;Language Usage&quot;, 
                                             &quot;General Science&quot;))

map.scores.by.class$Subject&lt;-factor(map.scores.by.grade$Subject, 
                                    levels=c(&quot;Mathematics&quot;, 
                                             &quot;Reading&quot;, 
                                             &quot;Language Usage&quot;, 
                                             &quot;General Science&quot;))

###Separate PDF for each School


#KAPS
#First by Grade
map.scores.primary&lt;-subset(map.scores.by.grade, SchoolName==&quot;KIPP Ascend Primary&quot;)

pdf(file=&quot;../../Figures/Fall12_MAP_KAPS.pdf&quot;, height=10.5, width=8)

for(s in sort(unique(map.scores.primary$Subject))){
  dfp&lt;-subset(map.scores.primary,Subject==s) #DataFrame to Plot
  for(g in as.character(sort(unique(dfp$Grade)))){
    ptitle &lt;- paste(&quot;KAPS 2012 Fall MAP Grade &quot;,g,&quot; &quot;,s,
                    &quot;\nRIT Scores, Expected Growth, and College Ready Growth\nby Quartile&quot;,
                    sep=&quot;&quot;)
    p&lt;-plot_MAP_Results_and_Goals(subset(dfp,Grade==g),ptitle, labxpos=113, minx=104)
    print(p)
  }
}
dev.off()

#Then by Classroom (KAPS only)

map.scores.primary.by.class&lt;-subset(map.scores.by.class, SchoolName==&quot;KIPP Ascend Primary&quot; &amp; ID!=&quot;50206087&quot;) 
# This kid is assinged to two classes in math as a 1st grader but the classes are K classees. Weird.

pdf(file=&quot;../../Figures/Fall12_MAP_KAPS_by_Classroom.pdf&quot;, height=10.5, width=8)
#Need to Loop by Subject, then grade, then classroom
for(s in as.character(sort(unique(map.scores.primary.by.class$Subject)))){
    dfs&lt;-subset(map.scores.primary.by.class,Subject==s) #DataFrame for subject
    for(g in as.character(sort(unique(dfs$Grade)))){
      dfp&lt;-subset(dfs, Grade==g)  #DataFrame for Plot
      for(c in as.character(sort(unique(dfp$ClassName)))){
        ptitle &lt;- paste(&quot;KAPS 2012 Fall MAP &quot;,c,&quot; (&quot;,g,&quot;) &quot;,s,
                        &quot;\nRIT Scores, Expected Growth, and College Ready Growth\nby Quartile&quot;,
                        sep=&quot;&quot;)
        p&lt;-plot_MAP_Results_and_Goals(subset(dfp, ClassName==c),ptitle, labxpos=113, minx=104)
        print(p)
      }
    }
}
dev.off()



#KAMS
map.scores.KAMS&lt;-subset(map.scores.by.grade, SchoolName==&quot;KIPP Ascend Middle School&quot;)

pdf(file=&quot;../../Figures/Fall12_MAP_KAMS.pdf&quot;, height=10.5, width=8)

for(s in sort(unique(map.scores.KAMS$Subject))){
  dfp&lt;-subset(map.scores.KAMS,Subject==s) #DataFrame to Plot
  for(g in as.character(sort(unique(dfp$Grade)))){
    ptitle &lt;- paste(&quot;KAMS 2012 Fall MAP Grade &quot;,g,&quot; &quot;,s,
                    &quot;\nRIT Scores, Expected Growth, and College Ready Growth\nby Quartile&quot;,
                    sep=&quot;&quot;)
    p&lt;-plot_MAP_Results_and_Goals(subset(dfp,Grade==g),ptitle, labxpos=170, minx=145,alp=.6)
    print(p)
  }
}
dev.off()


#KCCP
map.scores.KCCP&lt;-subset(map.scores.by.grade, SchoolName==&quot;KIPP Create Middle School&quot;)

pdf(file=&quot;../../Figures/Fall12_MAP_KCCP.pdf&quot;, height=10.5, width=8)

for(s in sort(unique(map.scores.KCCP$Subject))){
  dfp&lt;-subset(map.scores.KCCP,Subject==s) #DataFrame to Plot
  for(g in as.character(sort(unique(dfp$Grade)))){
    ptitle &lt;- paste(&quot;KCCP 2012 Fall MAP Grade &quot;,g,&quot; &quot;,s,
                    &quot;\nRIT Scores, Expected Growth, and College Ready Growth\nby Quartile&quot;,
                    sep=&quot;&quot;)
    p&lt;-plot_MAP_Results_and_Goals(subset(dfp,Grade==g),ptitle, labxpos=150, minx=140, alp=.6)
    print(p)
  }
}
dev.off()

</code></pre>

<h3>Comparative Distrubionts (really histograms), or How are our student&#39;s doing relatively to the rest of their peers throughtout this great land of ours?</h3>

<p>Now for some more high level views compared to the national distribution.  These figures are helpful in understanding where a whole grade or classroom is relative to nationally representative distribution.  However, we don&#39;t have such a distribution, so I simulated one using the nationally normed means and standard deviations for each subject-grade pair.  I assumed that the distributions were truncated Gaussian (i.e., normal) distributions and used some basic probability theory to construct the a sample distribution.  The code for this is in the <code>MAP_helper_fucntions.R</code> script in the <code>map_combined_histo_data()</code> function.  It&#39;s worth a look if you want to see how almost any distribution can be built up by starting with the \( U\sim(0,1) \), i.e., the uniform distribution over the interval from 0 to 1.  The histograms themselves are generated with the <code>map_comparative_histograms()</code> function in the same file.  </p>

<pre><code class="r"># get national summary statistics for Reading and Math, Grades K-2,5-8 for
# simulation
nwea.norms.fall &lt;- data.frame(Grade = factor(c(&quot;K&quot;, &quot;K&quot;, &quot;1&quot;, &quot;1&quot;, &quot;2&quot;, &quot;2&quot;, 
    &quot;5&quot;, &quot;5&quot;, &quot;6&quot;, &quot;6&quot;, &quot;7&quot;, &quot;7&quot;, &quot;8&quot;, &quot;8&quot;), levels = c(&quot;K&quot;, &quot;1&quot;, &quot;2&quot;, &quot;5&quot;, 
    &quot;6&quot;, &quot;7&quot;, &quot;8&quot;)), Subject = factor(c(&quot;Mathematics&quot;, &quot;Reading&quot;, &quot;Mathematics&quot;, 
    &quot;Reading&quot;, &quot;Mathematics&quot;, &quot;Reading&quot;, &quot;Mathematics&quot;, &quot;Reading&quot;, &quot;Mathematics&quot;, 
    &quot;Reading&quot;, &quot;Mathematics&quot;, &quot;Reading&quot;, &quot;Mathematics&quot;, &quot;Reading&quot;), levels = c(&quot;Mathematics&quot;, 
    &quot;Reading&quot;)), Mean = c(143.7, 142.5, 162.8, 160.3, 178.2, 175.9, 212.9, 209.8, 
    219.6, 212.3, 225.6, 216.3, 230.2, 219.3), SD = c(11.88, 10.71, 13.57, 12.76, 
    12.97, 15.44, 14.18, 14.21, 15.37, 14.39, 16.79, 14.23, 17.04, 14.86))





# KAMS

pm5 &lt;- map_comparative_histograms(map_combined_histo_data(kippdata = map.scores.by.grade, 
    normsdata = nwea.norms.fall, grade = 5, subj = &quot;Mathematics&quot;, schoolname = &quot;KAMS&quot;), 
    legendpos = &quot;none&quot;, title = &quot;MAP 2012 5th Grade\nKAMS vs. National\nMath&quot;)
</code></pre>

<pre><code>## Error: object &#39;map.scores.by.grade&#39; not found
</code></pre>

<pre><code class="r">
pm5
</code></pre>

<pre><code>## Error: object &#39;pm5&#39; not found
</code></pre>

<p>Again I welcome and encourage all feedback on this.   Free to email me at <a href="mailto:chaid@kippchicago.org">chaid@kippchicago.org</a> with any feedback. I hope this is helpful.</p>

</body>

</html>

